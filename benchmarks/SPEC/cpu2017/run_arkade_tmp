#!/bin/bash

ulimit -s 1048576
echo "Initial stack size"
ulimit -s

echo "Determine time unit [i, ms, B]"
read TIME_UNIT

echo "Determine the tool [mf, mk]"
read MEM_TOOL


if [ $MEM_TOOL == "mf" ]; then
    export MEM_TOOL="massif"
elif [ $MEM_TOOL == "mk" ]; then
    export MEM_TOOL="memcheck"
else
    echo "Invalid tool selection. Please choose 'mf' or 'mk'."
    exit 1
fi

if [ $MEM_TOOL == "memcheck" ]; then
    LEAK_CHECK_OPTION="--leak-check=full"
else
    LEAK_CHECK_OPTION=""
fi

valgrind --extra-debuginfo-path=/usr/lib/debug/.build-id/81    \
         --tool=$MEM_TOOL                                      \
         $LEAK_CHECK_OPTION                                    \
         --trace-children=yes                                  \
         --time-unit=$TIME_UNIT                                \
         --main-stacksize=1048576                               \
         -v                                                    \
         ./run_cpu_tmp
         #--trace-children-skip=build_peak_mytest,build_base_mytest,/usr/bin/gfortran \
         #--trace-children-skip=/home/arkade/github/arkade_pub/benchmarks/SPEC/cpu2017/bin/specperl  \
         #--trace-children-skip=specmake,specrxp                \
         #--trace-children-skip=*gfortran*,*specperl*,*specmake*,*specrxp*,*perl* \
         #--trace-children-skip=/home/arkade/github/arkade_pub/benchmarks/SPEC/cpu2017/bin/specperl,/home/arkade/github/arkade_pub/benchmarks/SPEC/cpu2017/bin/specmake,/home/arkade/github/arkade_pub/benchmarks/SPEC/cpu2017/bin/specrxp  \
